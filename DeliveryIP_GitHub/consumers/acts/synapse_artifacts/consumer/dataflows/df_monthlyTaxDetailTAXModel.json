{
    "name": "df_monthlyTaxDetailTAXModel",
    "properties": {
        "folder": {
            "name": "df_Operational"
        },
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "linkedService": {
                        "referenceName": "LS_DataLake",
                        "type": "LinkedServiceReference"
                    },
                    "name": "pbimonthly"
                }
            ],
            "sinks": [
                {
                    "name": "PBIMonthlyTaxTaxModel"
                }
            ],
            "transformations": [
                {
                    "name": "derivedColumn1"
                },
                {
                    "name": "aggregate1"
                }
            ],
            "scriptLines": [
                "parameters{",
                "     path as string,",
                "     filename as string",
                "}",
                "source(output(",
                "          ID as long,",
                "          ReportingPeriod as string,",
                "          IncomeTax as double,",
                "          IncomeTaxTarget as double,",
                "          ValueAddedTax as double,",
                "          ValueAddedTaxTarget as double,",
                "          CorporationTax as double,",
                "          CorporationTaxTarget as double,",
                "          PctTaxPayerCsatDigital as double,",
                "          PctTaxPayerCsatDigitalPredicted as double,",
                "          PctTaxPayerCsatDigitalTarget as double,",
                "          PctTaxPayerCsatPhysical as double,",
                "          PctTaxPayerCsatPredicted as double,",
                "          PctTaxPayerCsatPhysicalTarget as double,",
                "          CntTaxPayerComplaints as short,",
                "          CntTaxPayerComplaintsTarget as short,",
                "          PctTaxPayerCsatOverall as double,",
                "          PctTaxPayerCsatOverallTarget as double,",
                "          PctTaxPayerCsatOverallPredicted as double,",
                "          CntTaxReturnMail as integer,",
                "          CntTaxReturnMailTarget as integer,",
                "          PctPhysicalTaxReturnResponse15Days as short,",
                "          PctPhysicalTaxReturnResponse15DaysTarget as short,",
                "          CntTaxReturnInOffice as integer,",
                "          CntTaxReturnInOfficeTarget as integer,",
                "          CntTaxPayerCalls as integer,",
                "          TaxPayerCallAnswerTime as short,",
                "          CntTaxPayerCallWaiting10MinOrMore as short,",
                "          CntTier1Complaints as short,",
                "          CntTier2Complaints as short,",
                "          CntTaxReturnDigital as integer,",
                "          PctDigialTaxReturnOutOfOverall as double,",
                "          PctDigialTaxReturnOutOfOverallTarget as double,",
                "          PctDigitalTaxReturnResponse7Days as double,",
                "          PctDigitalTaxReturnResponse7DaysTarget as double,",
                "          PctTaxReturnAmended as double,",
                "          PctTaxReturnAmendedTarget as short,",
                "          PctTaxReturnAudited as double,",
                "          PctTaxReturnAuditedTarget as double,",
                "          PctTaxPayerCsatChangeNextMonth as double,",
                "          PctTaxPayerCsatChangeNextMonthTarget as double,",
                "          PctTaxPayerComplaintsChangeNextMonth as double,",
                "          PctTaxPayerComplaintsChangeNextMonthTarget as double,",
                "          PctTaxPayerTrafficInOfficesChangeNextMonth as double,",
                "          PctTaxPayerTrafficInOfficesChangeNextMonthTarget as double,",
                "          PctTaxPayerTrafficDigitalChangeNextMonth as double,",
                "          PctTaxPayerTrafficDigitalChangeNextMonthTarget as double",
                "     ),",
                "     useSchema: false,",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'delimited',",
                "     fileSystem: 'raw',",
                "     folderPath: (replace($path, \"raw/\", \"\")),",
                "     fileName: ($filename),",
                "     columnDelimiter: ',',",
                "     escapeChar: '\\\\',",
                "     quoteChar: '\\\"',",
                "     columnNamesAsHeader: true,",
                "     multiLineRow: true) ~> pbimonthly",
                "aggregate1 derive(IncomeTax = toDecimal(IncomeTax,18,2),",
                "          IncomeTaxTarget = toDecimal(IncomeTaxTarget,18,2),",
                "          ValueAddedTax = toDecimal(ValueAddedTax,18,2),",
                "          ValueAddedTaxTarget = toDecimal(ValueAddedTaxTarget,18,2),",
                "          CorporationTax = toDecimal(CorporationTax,18,2)) ~> derivedColumn1",
                "pbimonthly aggregate(groupBy(ID,",
                "          ReportingPeriod,",
                "          IncomeTax,",
                "          IncomeTaxTarget,",
                "          ValueAddedTax,",
                "          ValueAddedTaxTarget,",
                "          CorporationTax,",
                "          CorporationTaxTarget,",
                "          PctTaxPayerCsatDigital,",
                "          PctTaxPayerCsatDigitalPredicted,",
                "          PctTaxPayerCsatDigitalTarget,",
                "          PctTaxPayerCsatPhysical,",
                "          PctTaxPayerCsatPredicted,",
                "          PctTaxPayerCsatPhysicalTarget,",
                "          CntTaxPayerComplaints,",
                "          CntTaxPayerComplaintsTarget,",
                "          PctTaxPayerCsatOverall,",
                "          PctTaxPayerCsatOverallTarget,",
                "          PctTaxPayerCsatOverallPredicted,",
                "          CntTaxReturnMail,",
                "          CntTaxReturnMailTarget,",
                "          PctPhysicalTaxReturnResponse15Days,",
                "          PctPhysicalTaxReturnResponse15DaysTarget,",
                "          CntTaxReturnInOffice,",
                "          CntTaxReturnInOfficeTarget,",
                "          CntTaxPayerCalls,",
                "          TaxPayerCallAnswerTime,",
                "          CntTaxPayerCallWaiting10MinOrMore,",
                "          CntTier1Complaints,",
                "          CntTier2Complaints,",
                "          CntTaxReturnDigital,",
                "          PctDigialTaxReturnOutOfOverall,",
                "          PctDigialTaxReturnOutOfOverallTarget,",
                "          PctDigitalTaxReturnResponse7Days,",
                "          PctDigitalTaxReturnResponse7DaysTarget,",
                "          PctTaxReturnAmended,",
                "          PctTaxReturnAmendedTarget,",
                "          PctTaxReturnAudited,",
                "          PctTaxReturnAuditedTarget,",
                "          PctTaxPayerCsatChangeNextMonth,",
                "          PctTaxPayerCsatChangeNextMonthTarget,",
                "          PctTaxPayerComplaintsChangeNextMonth,",
                "          PctTaxPayerComplaintsChangeNextMonthTarget,",
                "          PctTaxPayerTrafficInOfficesChangeNextMonth,",
                "          PctTaxPayerTrafficInOfficesChangeNextMonthTarget,",
                "          PctTaxPayerTrafficDigitalChangeNextMonth,",
                "          PctTaxPayerTrafficDigitalChangeNextMonthTarget),",
                "     count = count(ID)) ~> aggregate1",
                "derivedColumn1 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     store: 'synapse',",
                "     databaseType: 'spark',",
                "     format: 'table',",
                "     database: 'TAXModel',",
                "     tableName: 'MonthlyTax') ~> PBIMonthlyTaxTaxModel"
            ]
        }
    }
}